---
title: "Developing Data Products Assignment 2"
author: "Simon Cox"
date: "13 April 2020"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
suppressPackageStartupMessages(library(caret))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(plotly))
data(mtcars)
```

## Introduction
This presentation charts the accuracy of the linear regression model created for the Course 7 assignment in the Coursera Data Science Programme. The results are generated by the plotly package in R.  

The regression model was built against the mtcars dataset. It predicts the mpg for a given car based on 3 features: 

* Weight (1000 lbs)
* Quarter Mile Time (seconds)
* Transmission Type (Auto or Manual)

## Code - Dataset Generation
The generation of the dataset used for the interactive chart is shown below:
```{r gen_dataset, echo = TRUE, comment = ''}
fit <- train(mpg ~ am + wt + qsec, data = mtcars, method = 'lm')
pred <- predict(fit, newdata = mtcars)
plotdf <- data.frame("Actual" = mtcars$mpg,
                     "Predicted" = pred,
                     "Transmission" = as.factor(mtcars$am),
                     "QMileTime" = mtcars$qsec, "Weight" = mtcars$wt)
levels(plotdf$Transmission) <- c("Automatic","Manual")
head(plotdf,5)
```

## Accuracy Chart

```{r plot, echo = FALSE}
mpgmin <- min(plotdf$Actual)
mpgmax <- max(plotdf$Actual)
g <- ggplot(data = plotdf, aes(x = Actual, y = Predicted, 
                               shape = Transmission, colour = Weight, size = QMileTime))
g <- g +
    geom_point() +
    geom_segment(aes(x = mpgmin, y = mpgmin, 
                     xend = mpgmax, yend = mpgmax),
                 size = 1,
                 colour = "steelblue") +
    labs(title = "Predicted MPG vs Actual MPG") +
    annotate("text",
             label = "NOTE: Size represents QMile Time",
             x=30, 
             y=15,
             size = 3) +
    guides(size=FALSE, alpha = FALSE) +
    scale_colour_gradient(low = "green", high = "blue")

ggplotly(g)
```

## Notes
It seems there is an issue with legends rendering correctly in ggplot, but not when this is passed to plotly. This was researched briefly but no solution is immediately apparent.


